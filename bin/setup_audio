#!/bin/bash
# setup_audio - One command to fix audio on Void Linux

set -e

GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

info() { echo -e "${GREEN}[*]${NC} $1"; }
warn() { echo -e "${YELLOW}[!]${NC} $1"; }
error() { echo -e "${RED}[x]${NC} $1" >&2; }

info "Setting up audio..."

# Install packages (libspa-bluetooth, NOT libspa-0.2-bluetooth)
sudo xbps-install -Sy \
    pipewire \
    wireplumber \
    alsa-pipewire \
    alsa-utils \
    pavucontrol \
    pamixer \
    libspa-bluetooth \
    pulseaudio-utils \
    rtkit \


# This tells PipeWire: "Whenever you start, automatically launch your friends."
# This prevents the 'Address already in use' errors we saw.
mkdir -p ~/.config/pipewire/pipewire.conf.d
ln -sf /usr/share/examples/wireplumber/10-wireplumber.conf ~/.config/pipewire/pipewire.conf.d/
ln -sf /usr/share/examples/pipewire/20-pipewire-pulse.conf ~/.config/pipewire/pipewire.conf.d/

# Add to audio group
if ! groups | grep -q audio; then
    sudo usermod -aG audio $USER
    warn "Added to audio group. Logout and login required."
fi


info "Audio packages installed!"
info ""
info "Add to your river config:"
info "  riverctl spawn 'pipewire'"
info "  riverctl spawn 'wireplumber'"
info "  riverctl spawn 'pipewire-pulse'"
info ""
info "Or for i3:"
info "  exec --no-startup-id pipewire"
info "  exec --no-startup-id wireplumber"
info "  exec --no-startup-id pipewire-pulse"
